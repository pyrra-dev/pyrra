{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended"],
  "dependencyDashboard": true,
  "baseBranches": ["main", "release-0.8"],
  "packageRules": [
    {
      "description": "Auto-merge minor and patch updates",
      "matchUpdateTypes": ["minor", "patch"],
      "automerge": true
    },
    {
      "description": "Go modules - daily schedule",
      "matchManagers": ["gomod"],
      "schedule": ["before 9am every weekday"]
    },
    {
      "description": "GitHub Actions - daily schedule",
      "matchManagers": ["github-actions"],
      "schedule": ["before 9am every weekday"]
    },
    {
      "description": "npm - weekly schedule",
      "matchManagers": ["npm"],
      "schedule": ["before 9am on monday"]
    },
    {
      "description": "Docker - weekly schedule",
      "matchManagers": ["dockerfile"],
      "schedule": ["before 9am on monday"]
    },
    {
      "description": "Release branch - only allow patch updates",
      "matchBaseBranches": ["release-0.8"],
      "matchUpdateTypes": ["major", "minor"],
      "enabled": false
    },
    {
      "description": "Release branch PRs get release label",
      "matchBaseBranches": ["release-0.8"],
      "addLabels": ["release"]
    },
    {
      "description": "Group Kubernetes Go modules",
      "matchManagers": ["gomod"],
      "matchPackagePatterns": ["^k8s.io/"],
      "groupName": "kubernetes packages"
    },
    {
      "description": "Group sigs.k8s.io Go modules",
      "matchManagers": ["gomod"],
      "matchPackagePatterns": ["^sigs.k8s.io/"],
      "groupName": "sigs.k8s.io packages"
    },
    {
      "description": "Group Prometheus Go modules",
      "matchManagers": ["gomod"],
      "matchPackagePatterns": ["^github.com/prometheus/"],
      "groupName": "prometheus packages"
    },
    {
      "description": "Group React packages",
      "matchManagers": ["npm"],
      "matchPackagePatterns": ["^react", "^@types/react"],
      "groupName": "react packages"
    },
    {
      "description": "Group testing packages (npm)",
      "matchManagers": ["npm"],
      "matchPackagePatterns": ["^@testing-library/", "^jest"],
      "groupName": "testing packages"
    },
    {
      "description": "Group ESLint packages",
      "matchManagers": ["npm"],
      "matchPackagePatterns": ["^eslint", "^@typescript-eslint/"],
      "groupName": "eslint packages"
    },
    {
      "description": "Group GitHub Actions",
      "matchManagers": ["github-actions"],
      "groupName": "github actions"
    },
    {
      "description": "One week stability period for Buf packages",
      "matchFileNames": ["buf.gen.yaml"],
      "minimumReleaseAge": "7 days"
    },
    {
      "description": "Node.js matrix versions - weekly schedule",
      "matchDatasources": ["node-version"],
      "schedule": ["before 9am on monday"]
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update Buf plugins",
      "fileMatch": ["(^|/)buf\\.gen\\.yaml$"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.+?) depName=(?<depName>.+?)(?: (?:packageName)=(?<packageName>.+?))?(?: versioning=(?<versioning>.+?))?\\s*-?\\s*plugin: ('|\")?.*:(?<currentValue>.+?)('|\")?\\s"
      ]
    },
    {
      "customType": "regex",
      "description": "Update Go tool versions in Makefile",
      "fileMatch": ["(^|/)Makefile$"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.+?) depName=(?<depName>.+?)\\s+go install .+@(?<currentValue>v[^\\s]+)"
      ]
    },
    {
      "customType": "regex",
      "description": "Update Node.js versions in GitHub Actions matrix",
      "fileMatch": ["^\\.github/workflows/[^/]+\\.ya?ml$"],
      "matchStrings": [
        "#\\s*renovate:\\s*datasource=(?<datasource>\\S+)\\s+depName=(?<depName>\\S+)\\s+versioning=(?<versioning>\\S+)\\s*\\n\\s*-\\s*(?<currentValue>\\d+)\\.x"
      ]
    }
  ]
}
