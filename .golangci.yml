version: "2"

run:
  deadline: 10m
  go: 1.23

output:
  format: colored-line-number

linters:
  enable:
    - godot
    - revive
    - whitespace
  formatters:
    - gofumpt
    - goimports

issues:
  exclude-dirs:
    - proto/
  exclude-rules:
    - path: _test.go
      linters:
        - errcheck

linters-settings:
  depguard:
    rules:
      Main:
        list-mode: lax
        allow:
          - $gostd
          - github.com/alecthomas/kong
          - github.com/bufbuild/connect-go
          - github.com/fsnotify/fsnotify
          - github.com/go-kit/log
          - github.com/go-kit/log/...
          - github.com/oklog/run
          - github.com/polarsignals/connect-go-prometheus
          - github.com/prometheus-operator/prometheus-operator/...
          - github.com/prometheus/alertmanager/...
          - github.com/prometheus/client_golang/...
          - github.com/prometheus/common/...
          - github.com/prometheus/prometheus/...
          - github.com/pyrra-dev/pyrra/...
          - github.com/rs/cors
          - github.com/spf13/viper
          - github.com/stretchr/testify/...
          - github.com/thanos-io/objstore/...
          - github.com/urfave/negroni
          - golang.org/x/...
          - google.golang.org/...
          - gopkg.in/yaml.v3
          - k8s.io/...
          - sigs.k8s.io/...
        deny:
          - pkg: sync/atomic
            desc: "Use go.uber.org/atomic instead of sync/atomic"
          - pkg: debug/elf
            desc: "Use github.com/parca-dev/parca/internal/go/debug/elf instead of debug/elf"
          - pkg: github.com/stretchr/testify/assert
            desc: "Use github.com/stretchr/testify/require instead of github.com/stretchr/testify/assert"
          - pkg: log
            desc: "Use github.com/go-kit/log instead of github.com/go-kit/kit/log"
          - pkg: github.com/go-kit/kit/log
            desc: "Use github.com/go-kit/log instead of github.com/go-kit/kit/log"
          - pkg: github.com/go-logr/logr
            desc: "Use github.com/go-kit/log instead of github.com/go-kit/kit/log"
          - pkg: github.com/pkg/errors
            desc: "Use fmt.Errorf instead"
  errcheck:
    exclude-functions:
      - "(github.com/go-kit/log.Logger).Log"
  goimports:
    local-prefixes: github.com/pyrra-dev/pyrra
  gofumpt:
    extra-rules: true
  misspell:
    locale: US
